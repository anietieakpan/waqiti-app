2025-04-23 03:07:11.603 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 470002 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 03:07:11.627 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 03:07:11.634 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 03:07:18.299 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 03:07:20.094 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:07:20.094 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:07:20.735 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 596 ms. Found 5 JPA repository interfaces.
2025-04-23 03:07:22.963 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:07:22.970 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 03:07:23.302 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:07:23.304 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:07:23.304 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:07:23.305 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:07:23.306 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:07:23.307 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 288 ms. Found 0 Redis repository interfaces.
2025-04-23 03:07:25.173 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=af2faf9e-b841-38ee-9647-10d95296b477
2025-04-23 03:07:25.528 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'com.waqiti.user.client.IntegrationServiceClient' available: more than one 'primary' bean found among candidates: [[com.waqiti.user.client.IntegrationServiceClient, integrationServiceClient]]
2025-04-23 03:07:25.592 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-04-23 03:07:25.699 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'com.waqiti.user.client.IntegrationServiceClient' available: more than one 'primary' bean found among candidates: [[com.waqiti.user.client.IntegrationServiceClient, integrationServiceClient]]
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.determinePrimaryCandidate(MockitoPostProcessor.java:314)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.getBeanName(MockitoPostProcessor.java:216)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.registerMock(MockitoPostProcessor.java:177)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.register(MockitoPostProcessor.java:167)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:141)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:129)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:363)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:197)
	at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:775)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:597)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)
	at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1442)
	at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:552)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)
	at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.postProcessFields(MockitoTestExecutionListener.java:110)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.injectFields(MockitoTestExecutionListener.java:94)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.prepareTestInstance(MockitoTestExecutionListener.java:61)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)
	at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
	at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-04-23 03:07:25.735 [main] ERROR o.s.test.context.TestContextManager - Caught exception while allowing TestExecutionListener [org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener] to prepare test instance [com.waqiti.user.auth.AuthenticationMfaE2ETest@7efba9b9]
java.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@11cdf948 testClass = com.waqiti.user.auth.AuthenticationMfaE2ETest, locations = [], classes = [com.waqiti.user.UserServiceApplication], contextInitializerClasses = [], activeProfiles = ["test"], propertySourceDescriptors = [PropertySourceDescriptor[locations=[], ignoreResourceNotFound=false, name=null, propertySourceFactory=null, encoding=null]], propertySourceProperties = ["spring.main.allow-bean-definition-overriding=true", "oauth2.state.secret=test-oauth2-state-secret", "spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.oauth2.client.OAuth2ClientAutoConfiguration,org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration", "security.jwt.token.secret-key=VGhpc0lzQVZlcnlMb25nQW5kU2VjdXJlVGVzdEtleVRoYXRJc1N1ZmZpY2llbnRseUxvbmdGb3JUaGVITUFDU0hBQWxnb3JpdGhtMTIzNDU2Nzg5", "org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true", "server.port=0"], contextCustomizers = [[ImportsContextCustomizer@25a2f432 key = [org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration, com.waqiti.user.config.MfaTestConfig, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration, org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientAutoConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@1fb669c3, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@68df9280, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@204a2a38, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@4716be8b, org.springframework.boot.test.web.reactive.server.WebTestClientContextCustomizer@291a7e3c, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@4b3fa0b3, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@61544ae6, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@36639128, org.springframework.boot.test.context.SpringBootTestAnnotation@14676b26], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:180)
	at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.postProcessFields(MockitoTestExecutionListener.java:110)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.injectFields(MockitoTestExecutionListener.java:94)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.prepareTestInstance(MockitoTestExecutionListener.java:61)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)
	at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
	at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
Caused by: org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'com.waqiti.user.client.IntegrationServiceClient' available: more than one 'primary' bean found among candidates: [[com.waqiti.user.client.IntegrationServiceClient, integrationServiceClient]]
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.determinePrimaryCandidate(MockitoPostProcessor.java:314)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.getBeanName(MockitoPostProcessor.java:216)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.registerMock(MockitoPostProcessor.java:177)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.register(MockitoPostProcessor.java:167)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:141)
	at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:129)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:363)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:197)
	at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:775)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:597)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)
	at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1442)
	at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:552)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)
	... 74 common frames omitted
2025-04-23 03:07:25.866 [main] ERROR o.s.test.context.TestContextManager - Caught exception while allowing TestExecutionListener [org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener] to prepare test instance [com.waqiti.user.auth.AuthenticationMfaE2ETest@c6a3f47]
java.lang.IllegalStateException: ApplicationContext failure threshold (1) exceeded: skipping repeated attempt to load context for [WebMergedContextConfiguration@11cdf948 testClass = com.waqiti.user.auth.AuthenticationMfaE2ETest, locations = [], classes = [com.waqiti.user.UserServiceApplication], contextInitializerClasses = [], activeProfiles = ["test"], propertySourceDescriptors = [PropertySourceDescriptor[locations=[], ignoreResourceNotFound=false, name=null, propertySourceFactory=null, encoding=null]], propertySourceProperties = ["spring.main.allow-bean-definition-overriding=true", "oauth2.state.secret=test-oauth2-state-secret", "spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.oauth2.client.OAuth2ClientAutoConfiguration,org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration", "security.jwt.token.secret-key=VGhpc0lzQVZlcnlMb25nQW5kU2VjdXJlVGVzdEtleVRoYXRJc1N1ZmZpY2llbnRseUxvbmdGb3JUaGVITUFDU0hBQWxnb3JpdGhtMTIzNDU2Nzg5", "org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true", "server.port=0"], contextCustomizers = [[ImportsContextCustomizer@25a2f432 key = [org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration, com.waqiti.user.config.MfaTestConfig, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration, org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientAutoConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@1fb669c3, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@68df9280, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@204a2a38, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@4716be8b, org.springframework.boot.test.web.reactive.server.WebTestClientContextCustomizer@291a7e3c, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@4b3fa0b3, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@61544ae6, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@36639128, org.springframework.boot.test.context.SpringBootTestAnnotation@14676b26], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:145)
	at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.postProcessFields(MockitoTestExecutionListener.java:110)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.injectFields(MockitoTestExecutionListener.java:94)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.prepareTestInstance(MockitoTestExecutionListener.java:61)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)
	at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
	at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-04-23 03:21:04.723 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 472642 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 03:21:04.727 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 03:21:04.729 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 03:21:06.773 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 03:21:07.515 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:21:07.515 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:21:07.910 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 370 ms. Found 5 JPA repository interfaces.
2025-04-23 03:21:08.961 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:21:08.964 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 03:21:09.061 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:21:09.066 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:21:09.066 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:21:09.067 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:21:09.068 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:21:09.068 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 80 ms. Found 0 Redis repository interfaces.
2025-04-23 03:21:10.087 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=16a5da9b-1d72-3679-b627-78004a1e2285
2025-04-23 03:21:14.309 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
2025-04-23 03:21:14.329 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-04-23 03:21:14.329 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-04-23 03:21:14.643 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-04-23 03:21:14.644 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 9371 ms
2025-04-23 03:21:15.924 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-04-23 03:21:15.927 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-04-23 03:21:15.927 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-04-23 03:21:15.983 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:32787/testdb (PostgreSQL 13.20)
2025-04-23 03:21:16.044 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table "public"."flyway_schema_history" does not exist yet
2025-04-23 03:21:16.050 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.036s)
2025-04-23 03:21:16.067 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table "public"."flyway_schema_history" ...
2025-04-23 03:21:16.123 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": << Empty Schema >>
2025-04-23 03:21:16.140 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "1 - create user tables"
2025-04-23 03:21:16.179 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "2 - create mfa tables"
2025-04-23 03:21:16.197 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.026s)
2025-04-23 03:21:16.491 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-04-23 03:21:16.642 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-04-23 03:21:16.766 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-04-23 03:21:17.139 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-04-23 03:21:17.209 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-04-23 03:21:17.244 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4628344c
2025-04-23 03:21:17.250 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-04-23 03:21:17.338 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-04-23 03:21:19.687 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-04-23 03:21:19.729 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:21:19.735 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:21:19.735 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkjcad5nfve11khsnpwj1mv8frj" of relation "user_profiles" does not exist, skipping
2025-04-23 03:21:19.736 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 03:21:19.737 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:21:19.738 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkhfh9dx7w3ubf1co1vdev94g3f" of relation "user_roles" does not exist, skipping
2025-04-23 03:21:19.738 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 03:21:19.741 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 03:21:19.743 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 03:21:19.744 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 03:21:19.746 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 03:21:19.748 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:21:19.749 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - drop cascades to constraint verification_tokens_user_id_fkey on table verification_tokens
2025-04-23 03:21:19.749 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 03:21:19.761 [main] DEBUG org.hibernate.SQL - 
    create table mfa_configurations (
        enabled boolean not null,
        verified boolean not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id uuid not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        secret varchar(255),
        primary key (id)
    )
2025-04-23 03:21:19.764 [main] DEBUG org.hibernate.SQL - 
    create table mfa_verification_codes (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        code varchar(255) not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        primary key (id)
    )
2025-04-23 03:21:19.768 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        date_of_birth date,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        user_id uuid not null,
        address_line1 varchar(255),
        address_line2 varchar(255),
        city varchar(255),
        country varchar(255),
        created_by varchar(255),
        first_name varchar(255),
        last_name varchar(255),
        postal_code varchar(255),
        preferred_currency varchar(255),
        preferred_language varchar(255),
        profile_picture_url varchar(255),
        state varchar(255),
        updated_by varchar(255),
        primary key (user_id)
    )
2025-04-23 03:21:19.773 [main] DEBUG org.hibernate.SQL - 
    create table user_roles (
        user_id uuid not null,
        role varchar(255)
    )
2025-04-23 03:21:19.780 [main] DEBUG org.hibernate.SQL - 
    create table users (
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        created_by varchar(255),
        email varchar(255) not null unique,
        external_id varchar(255) not null,
        kyc_status varchar(255) not null check (kyc_status in ('NOT_STARTED','IN_PROGRESS','PENDING_REVIEW','APPROVED','REJECTED')),
        password_hash varchar(255) not null,
        phone_number varchar(255),
        status varchar(255) not null check (status in ('PENDING','ACTIVE','SUSPENDED','CLOSED')),
        updated_by varchar(255),
        username varchar(255) not null unique,
        primary key (id)
    )
2025-04-23 03:21:19.785 [main] DEBUG org.hibernate.SQL - 
    create table verification_tokens (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        token varchar(255) not null unique,
        type varchar(255) not null check (type in ('EMAIL','PHONE','KYC_BASIC','KYC_FULL','PASSWORD_RESET')),
        primary key (id)
    )
2025-04-23 03:21:19.790 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint FKjcad5nfve11khsnpwj1mv8frj 
       foreign key (user_id) 
       references users
2025-04-23 03:21:19.792 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       add constraint FKhfh9dx7w3ubf1co1vdev94g3f 
       foreign key (user_id) 
       references users
2025-04-23 03:21:19.826 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:21:20.591 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-04-23 03:21:23.289 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-04-23 03:21:25.852 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator'
2025-04-23 03:21:26.218 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/oauth2/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@7772f15d, org.springframework.security.web.session.ForceEagerSessionCreationFilter@40589959, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3887bf5b, org.springframework.security.web.context.SecurityContextHolderFilter@2ddf5e74, org.springframework.security.web.header.HeaderWriterFilter@426218fc, org.springframework.security.web.csrf.CsrfFilter@5d262de5, org.springframework.security.web.authentication.logout.LogoutFilter@70f3e678, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@36c234f8, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@54155e6e, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@792149c8, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@8b64a15, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@53bcb138, org.springframework.security.web.session.SessionManagementFilter@2b27b44d, org.springframework.security.web.access.ExceptionTranslationFilter@36a2fd51, org.springframework.security.web.access.intercept.AuthorizationFilter@442eca97]
2025-04-23 03:21:26.258 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration': Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'tokenSecurityFilterChain' defined in class path resource [com/waqiti/user/config/OAuth2SecurityConfig.class]: Failed to instantiate [org.springframework.security.web.SecurityFilterChain]: Factory method 'tokenSecurityFilterChain' threw exception with message: No qualifying bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' available
2025-04-23 03:21:26.282 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:21:26.283 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:21:26.285 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 03:21:26.287 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 03:21:26.290 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 03:21:26.292 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 03:21:26.294 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 03:21:26.295 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 03:21:26.297 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 03:21:26.301 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-04-23 03:21:26.309 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-04-23 03:21:26.335 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-04-23 03:21:26.405 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-04-23 03:21:26.515 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of method setFilterChains in org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration required a bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' that could not be found.


Action:

Consider defining a bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' in your configuration.

2025-04-23 03:21:26.544 [main] ERROR o.s.test.context.TestContextManager - Caught exception while allowing TestExecutionListener [org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener] to prepare test instance [com.waqiti.user.auth.AuthenticationMfaE2ETest@4fd7ded3]
java.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@49e666e2 testClass = com.waqiti.user.auth.AuthenticationMfaE2ETest, locations = [], classes = [com.waqiti.user.UserServiceApplication], contextInitializerClasses = [], activeProfiles = ["test"], propertySourceDescriptors = [PropertySourceDescriptor[locations=[], ignoreResourceNotFound=false, name=null, propertySourceFactory=null, encoding=null]], propertySourceProperties = ["spring.main.allow-bean-definition-overriding=true", "oauth2.state.secret=test-oauth2-state-secret", "security.jwt.token.secret-key=VGhpc0lzQVZlcnlMb25nQW5kU2VjdXJlVGVzdEtleVRoYXRJc1N1ZmZpY2llbnRseUxvbmdGb3JUaGVITUFDU0hBQWxnb3JpdGhtMTIzNDU2Nzg5", "org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true", "server.port=0"], contextCustomizers = [[ImportsContextCustomizer@385c3093 key = [org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration, com.waqiti.user.config.MfaTestConfig, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration, org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientAutoConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@7164ca4c, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@7a220c9a, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@cd038c79, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@3b7d3a38, org.springframework.boot.test.web.reactive.server.WebTestClientContextCustomizer@60df60da, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@4b3fa0b3, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@4b23c30a, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@36639128, org.springframework.boot.test.context.SpringBootTestAnnotation@14676b26], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:180)
	at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.postProcessFields(MockitoTestExecutionListener.java:110)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.injectFields(MockitoTestExecutionListener.java:94)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.prepareTestInstance(MockitoTestExecutionListener.java:61)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)
	at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
	at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration': Unsatisfied dependency expressed through method 'setFilterChains' parameter 0: Error creating bean with name 'tokenSecurityFilterChain' defined in class path resource [com/waqiti/user/config/OAuth2SecurityConfig.class]: Failed to instantiate [org.springframework.security.web.SecurityFilterChain]: Factory method 'tokenSecurityFilterChain' threw exception with message: No qualifying bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' available
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredMethodElement.resolveMethodArguments(AutowiredAnnotationBeanPostProcessor.java:880)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredMethodElement.inject(AutowiredAnnotationBeanPostProcessor.java:833)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:493)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1420)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:946)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)
	at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)
	at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1442)
	at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:552)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)
	at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)
	... 74 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'tokenSecurityFilterChain' defined in class path resource [com/waqiti/user/config/OAuth2SecurityConfig.class]: Failed to instantiate [org.springframework.security.web.SecurityFilterChain]: Factory method 'tokenSecurityFilterChain' threw exception with message: No qualifying bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' available
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:655)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:643)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1336)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1166)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.addCandidateEntry(DefaultListableBeanFactory.java:1687)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:1651)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveMultipleBeanCollection(DefaultListableBeanFactory.java:1541)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveMultipleBeans(DefaultListableBeanFactory.java:1509)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1390)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1348)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredMethodElement.resolveMethodArguments(AutowiredAnnotationBeanPostProcessor.java:872)
	... 100 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.security.web.SecurityFilterChain]: Factory method 'tokenSecurityFilterChain' threw exception with message: No qualifying bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' available
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:178)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:651)
	... 117 common frames omitted
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.security.oauth2.jwt.JwtDecoder' available
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:332)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1191)
	at org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer$JwtConfigurer.getJwtDecoder(OAuth2ResourceServerConfigurer.java:437)
	at org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer$JwtConfigurer.getAuthenticationProvider(OAuth2ResourceServerConfigurer.java:446)
	at org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer.getAuthenticationProvider(OAuth2ResourceServerConfigurer.java:346)
	at org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer.init(OAuth2ResourceServerConfigurer.java:264)
	at org.springframework.security.config.annotation.web.configurers.oauth2.server.resource.OAuth2ResourceServerConfigurer.init(OAuth2ResourceServerConfigurer.java:147)
	at org.springframework.security.config.annotation.AbstractConfiguredSecurityBuilder.init(AbstractConfiguredSecurityBuilder.java:365)
	at org.springframework.security.config.annotation.AbstractConfiguredSecurityBuilder.doBuild(AbstractConfiguredSecurityBuilder.java:327)
	at org.springframework.security.config.annotation.AbstractSecurityBuilder.build(AbstractSecurityBuilder.java:38)
	at com.waqiti.user.config.OAuth2SecurityConfig.tokenSecurityFilterChain(OAuth2SecurityConfig.java:40)
	at com.waqiti.user.config.OAuth2SecurityConfig$$SpringCGLIB$$0.CGLIB$tokenSecurityFilterChain$2(<generated>)
	at com.waqiti.user.config.OAuth2SecurityConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:331)
	at com.waqiti.user.config.OAuth2SecurityConfig$$SpringCGLIB$$0.tokenSecurityFilterChain(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:140)
	... 118 common frames omitted
2025-04-23 03:21:26.645 [main] ERROR o.s.test.context.TestContextManager - Caught exception while allowing TestExecutionListener [org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener] to prepare test instance [com.waqiti.user.auth.AuthenticationMfaE2ETest@3b591a07]
java.lang.IllegalStateException: ApplicationContext failure threshold (1) exceeded: skipping repeated attempt to load context for [WebMergedContextConfiguration@49e666e2 testClass = com.waqiti.user.auth.AuthenticationMfaE2ETest, locations = [], classes = [com.waqiti.user.UserServiceApplication], contextInitializerClasses = [], activeProfiles = ["test"], propertySourceDescriptors = [PropertySourceDescriptor[locations=[], ignoreResourceNotFound=false, name=null, propertySourceFactory=null, encoding=null]], propertySourceProperties = ["spring.main.allow-bean-definition-overriding=true", "oauth2.state.secret=test-oauth2-state-secret", "security.jwt.token.secret-key=VGhpc0lzQVZlcnlMb25nQW5kU2VjdXJlVGVzdEtleVRoYXRJc1N1ZmZpY2llbnRseUxvbmdGb3JUaGVITUFDU0hBQWxnb3JpdGhtMTIzNDU2Nzg5", "org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true", "server.port=0"], contextCustomizers = [[ImportsContextCustomizer@385c3093 key = [org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebDriverAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration, org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration, org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcSecurityConfiguration, com.waqiti.user.config.MfaTestConfig, org.springframework.boot.test.autoconfigure.web.servlet.MockMvcWebClientAutoConfiguration, org.springframework.boot.test.autoconfigure.web.reactive.WebTestClientAutoConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@7164ca4c, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@7a220c9a, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@cd038c79, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@3b7d3a38, org.springframework.boot.test.web.reactive.server.WebTestClientContextCustomizer@60df60da, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@4b3fa0b3, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@4b23c30a, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@36639128, org.springframework.boot.test.context.SpringBootTestAnnotation@14676b26], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]
	at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:145)
	at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.postProcessFields(MockitoTestExecutionListener.java:110)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.injectFields(MockitoTestExecutionListener.java:94)
	at org.springframework.boot.test.mock.mockito.MockitoTestExecutionListener.prepareTestInstance(MockitoTestExecutionListener.java:61)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)
	at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
	at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-04-23 03:36:03.759 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 475507 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 03:36:03.761 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 03:36:03.763 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 03:36:05.885 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 03:36:06.611 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:36:06.612 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:36:06.886 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 259 ms. Found 5 JPA repository interfaces.
2025-04-23 03:36:06.960 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:36:06.961 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:36:07.023 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 61 ms. Found 5 JPA repository interfaces.
2025-04-23 03:36:08.018 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:36:08.020 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 03:36:08.113 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:36:08.115 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:36:08.117 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:36:08.118 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:36:08.118 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:36:08.119 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 0 Redis repository interfaces.
2025-04-23 03:36:08.805 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d8179f7-9ecb-3faf-bd56-72724331021d
2025-04-23 03:36:13.942 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
2025-04-23 03:36:13.963 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-04-23 03:36:13.963 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-04-23 03:36:14.098 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-04-23 03:36:14.099 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 9827 ms
2025-04-23 03:36:15.291 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-04-23 03:36:15.292 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-04-23 03:36:15.292 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-04-23 03:36:15.333 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:32789/testdb (PostgreSQL 13.20)
2025-04-23 03:36:15.391 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table "public"."flyway_schema_history" does not exist yet
2025-04-23 03:36:15.397 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.036s)
2025-04-23 03:36:15.415 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table "public"."flyway_schema_history" ...
2025-04-23 03:36:15.473 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": << Empty Schema >>
2025-04-23 03:36:15.493 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "1 - create user tables"
2025-04-23 03:36:15.579 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "2 - create mfa tables"
2025-04-23 03:36:15.600 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.036s)
2025-04-23 03:36:15.879 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-04-23 03:36:16.025 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-04-23 03:36:16.122 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-04-23 03:36:16.363 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-04-23 03:36:16.435 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-04-23 03:36:16.471 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@34207fde
2025-04-23 03:36:16.475 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-04-23 03:36:16.534 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-04-23 03:36:19.238 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-04-23 03:36:19.280 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:36:19.291 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:36:19.292 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkjcad5nfve11khsnpwj1mv8frj" of relation "user_profiles" does not exist, skipping
2025-04-23 03:36:19.293 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 03:36:19.295 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:36:19.297 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkhfh9dx7w3ubf1co1vdev94g3f" of relation "user_roles" does not exist, skipping
2025-04-23 03:36:19.298 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 03:36:19.301 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 03:36:19.303 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 03:36:19.305 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 03:36:19.308 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 03:36:19.314 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:36:19.314 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - drop cascades to constraint verification_tokens_user_id_fkey on table verification_tokens
2025-04-23 03:36:19.315 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 03:36:19.339 [main] DEBUG org.hibernate.SQL - 
    create table mfa_configurations (
        enabled boolean not null,
        verified boolean not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id uuid not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        secret varchar(255),
        primary key (id)
    )
2025-04-23 03:36:19.344 [main] DEBUG org.hibernate.SQL - 
    create table mfa_verification_codes (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        code varchar(255) not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        primary key (id)
    )
2025-04-23 03:36:19.347 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        date_of_birth date,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        user_id uuid not null,
        address_line1 varchar(255),
        address_line2 varchar(255),
        city varchar(255),
        country varchar(255),
        created_by varchar(255),
        first_name varchar(255),
        last_name varchar(255),
        postal_code varchar(255),
        preferred_currency varchar(255),
        preferred_language varchar(255),
        profile_picture_url varchar(255),
        state varchar(255),
        updated_by varchar(255),
        primary key (user_id)
    )
2025-04-23 03:36:19.355 [main] DEBUG org.hibernate.SQL - 
    create table user_roles (
        user_id uuid not null,
        role varchar(255)
    )
2025-04-23 03:36:19.360 [main] DEBUG org.hibernate.SQL - 
    create table users (
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        created_by varchar(255),
        email varchar(255) not null unique,
        external_id varchar(255) not null,
        kyc_status varchar(255) not null check (kyc_status in ('NOT_STARTED','IN_PROGRESS','PENDING_REVIEW','APPROVED','REJECTED')),
        password_hash varchar(255) not null,
        phone_number varchar(255),
        status varchar(255) not null check (status in ('PENDING','ACTIVE','SUSPENDED','CLOSED')),
        updated_by varchar(255),
        username varchar(255) not null unique,
        primary key (id)
    )
2025-04-23 03:36:19.368 [main] DEBUG org.hibernate.SQL - 
    create table verification_tokens (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        token varchar(255) not null unique,
        type varchar(255) not null check (type in ('EMAIL','PHONE','KYC_BASIC','KYC_FULL','PASSWORD_RESET')),
        primary key (id)
    )
2025-04-23 03:36:19.372 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint FKjcad5nfve11khsnpwj1mv8frj 
       foreign key (user_id) 
       references users
2025-04-23 03:36:19.381 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       add constraint FKhfh9dx7w3ubf1co1vdev94g3f 
       foreign key (user_id) 
       references users
2025-04-23 03:36:19.395 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:36:20.471 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-04-23 03:36:23.893 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-04-23 03:36:26.212 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator'
2025-04-23 03:36:26.409 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@28da3eb1, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@47f5ddf4, org.springframework.security.web.context.SecurityContextHolderFilter@26d6daec, org.springframework.security.web.header.HeaderWriterFilter@6b3df144, org.springframework.web.filter.CorsFilter@4ac5fab8, org.springframework.security.web.authentication.logout.LogoutFilter@367d620d, com.waqiti.user.security.JwtAuthenticationFilter@151c870d, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@53fade9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@36a2fd51, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@6cca0ca9, org.springframework.security.web.session.SessionManagementFilter@53a858b0, org.springframework.security.web.access.ExceptionTranslationFilter@48afc141, org.springframework.security.web.access.intercept.AuthorizationFilter@72021abd]
2025-04-23 03:36:26.612 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/oauth2/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@3fae3045, org.springframework.security.web.session.ForceEagerSessionCreationFilter@2bc7f48d, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@39946f0, org.springframework.security.web.context.SecurityContextHolderFilter@1bdfa51f, org.springframework.security.web.header.HeaderWriterFilter@79a6e0e6, org.springframework.security.web.csrf.CsrfFilter@1d430022, org.springframework.security.web.authentication.logout.LogoutFilter@11014d1b, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@60ed5158, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@9608d1d, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@55b0d752, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@532e4f1a, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@60950f4b, org.springframework.security.web.session.SessionManagementFilter@7f4f3ae4, org.springframework.security.web.access.ExceptionTranslationFilter@47763ec6, org.springframework.security.web.access.intercept.AuthorizationFilter@63afc3e0]
2025-04-23 03:36:26.664 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@d6b8329, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@1aa1c691, org.springframework.security.web.context.SecurityContextHolderFilter@2a97559f, org.springframework.security.web.header.HeaderWriterFilter@13b84cf9, org.springframework.security.web.authentication.logout.LogoutFilter@5bdaeec8, org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter@73a9f793, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@49b94e25, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@18370c6f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7a9b56b2, org.springframework.security.web.session.SessionManagementFilter@1d49cb96, org.springframework.security.web.access.ExceptionTranslationFilter@63901bab, org.springframework.security.web.access.intercept.AuthorizationFilter@786560e9]
2025-04-23 03:36:29.662 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring TestDispatcherServlet ''
2025-04-23 03:36:29.663 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-04-23 03:36:29.665 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 1 ms
2025-04-23 03:36:30.572 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 44631 (http) with context path ''
2025-04-23 03:36:30.614 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Started AuthenticationMfaE2ETest in 27.696 seconds (process running for 34.642)
2025-04-23 03:36:30.931 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 03:36:30.953 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 03:36:30.961 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 03:36:31.183 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 03:36:31.199 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 03:36:31.594 [http-nio-auto-1-exec-2] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-04-23 03:36:31.594 [http-nio-auto-1-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-04-23 03:36:31.596 [http-nio-auto-1-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-04-23 03:36:31.614 [http-nio-auto-1-exec-2] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/v1/auth/login' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-04-23 03:36:31.626 [http-nio-auto-1-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 03:36:31.650 [http-nio-auto-1-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 03:36:31.757 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 03:36:31.762 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 03:36:31.766 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 03:36:31.784 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 03:36:31.803 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 03:36:31.807 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 03:36:31.885 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 03:36:31.887 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 03:36:31.892 [http-nio-auto-1-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 03:36:31.894 [http-nio-auto-1-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 03:36:32.524 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:36:32.526 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:36:32.538 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@34207fde (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.543 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@288fcdff (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.544 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@3c21fa18 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.546 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@28df32d6 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.547 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@780fb537 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.549 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@188937f1 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.550 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@3dfc79aa (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.552 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@2ae01871 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.553 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@32ba6632 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:36:32.556 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@5f814e9c (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:28.530 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 478934 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 03:54:28.533 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 03:54:28.534 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 03:54:30.506 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 03:54:31.147 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:54:31.148 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:54:31.598 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 436 ms. Found 5 JPA repository interfaces.
2025-04-23 03:54:31.682 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:54:31.682 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 03:54:31.777 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 94 ms. Found 5 JPA repository interfaces.
2025-04-23 03:54:32.923 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 03:54:32.925 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 03:54:32.989 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:54:32.989 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:54:32.991 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:54:32.992 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:54:32.993 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 03:54:32.993 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 53 ms. Found 0 Redis repository interfaces.
2025-04-23 03:54:33.793 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d8179f7-9ecb-3faf-bd56-72724331021d
2025-04-23 03:54:38.289 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
2025-04-23 03:54:38.319 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-04-23 03:54:38.320 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-04-23 03:54:38.691 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-04-23 03:54:38.692 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 9628 ms
2025-04-23 03:54:40.173 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-04-23 03:54:40.174 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-04-23 03:54:40.175 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-04-23 03:54:40.222 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:32791/testdb (PostgreSQL 13.20)
2025-04-23 03:54:40.291 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table "public"."flyway_schema_history" does not exist yet
2025-04-23 03:54:40.297 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.035s)
2025-04-23 03:54:40.320 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table "public"."flyway_schema_history" ...
2025-04-23 03:54:40.379 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": << Empty Schema >>
2025-04-23 03:54:40.403 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "1 - create user tables"
2025-04-23 03:54:40.458 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "2 - create mfa tables"
2025-04-23 03:54:40.482 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.042s)
2025-04-23 03:54:40.804 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-04-23 03:54:41.017 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-04-23 03:54:41.118 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-04-23 03:54:41.365 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-04-23 03:54:41.432 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-04-23 03:54:41.467 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3b8ec458
2025-04-23 03:54:41.471 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-04-23 03:54:41.540 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-04-23 03:54:43.655 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-04-23 03:54:43.686 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:54:43.691 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:54:43.691 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkjcad5nfve11khsnpwj1mv8frj" of relation "user_profiles" does not exist, skipping
2025-04-23 03:54:43.692 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 03:54:43.694 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:54:43.695 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkhfh9dx7w3ubf1co1vdev94g3f" of relation "user_roles" does not exist, skipping
2025-04-23 03:54:43.695 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 03:54:43.698 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 03:54:43.702 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 03:54:43.704 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 03:54:43.706 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 03:54:43.710 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 03:54:43.710 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - drop cascades to constraint verification_tokens_user_id_fkey on table verification_tokens
2025-04-23 03:54:43.711 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 03:54:43.729 [main] DEBUG org.hibernate.SQL - 
    create table mfa_configurations (
        enabled boolean not null,
        verified boolean not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id uuid not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        secret varchar(255),
        primary key (id)
    )
2025-04-23 03:54:43.733 [main] DEBUG org.hibernate.SQL - 
    create table mfa_verification_codes (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        code varchar(255) not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        primary key (id)
    )
2025-04-23 03:54:43.736 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        date_of_birth date,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        user_id uuid not null,
        address_line1 varchar(255),
        address_line2 varchar(255),
        city varchar(255),
        country varchar(255),
        created_by varchar(255),
        first_name varchar(255),
        last_name varchar(255),
        postal_code varchar(255),
        preferred_currency varchar(255),
        preferred_language varchar(255),
        profile_picture_url varchar(255),
        state varchar(255),
        updated_by varchar(255),
        primary key (user_id)
    )
2025-04-23 03:54:43.739 [main] DEBUG org.hibernate.SQL - 
    create table user_roles (
        user_id uuid not null,
        role varchar(255)
    )
2025-04-23 03:54:43.744 [main] DEBUG org.hibernate.SQL - 
    create table users (
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        created_by varchar(255),
        email varchar(255) not null unique,
        external_id varchar(255) not null,
        kyc_status varchar(255) not null check (kyc_status in ('NOT_STARTED','IN_PROGRESS','PENDING_REVIEW','APPROVED','REJECTED')),
        password_hash varchar(255) not null,
        phone_number varchar(255),
        status varchar(255) not null check (status in ('PENDING','ACTIVE','SUSPENDED','CLOSED')),
        updated_by varchar(255),
        username varchar(255) not null unique,
        primary key (id)
    )
2025-04-23 03:54:43.748 [main] DEBUG org.hibernate.SQL - 
    create table verification_tokens (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        token varchar(255) not null unique,
        type varchar(255) not null check (type in ('EMAIL','PHONE','KYC_BASIC','KYC_FULL','PASSWORD_RESET')),
        primary key (id)
    )
2025-04-23 03:54:43.750 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint FKjcad5nfve11khsnpwj1mv8frj 
       foreign key (user_id) 
       references users
2025-04-23 03:54:43.752 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       add constraint FKhfh9dx7w3ubf1co1vdev94g3f 
       foreign key (user_id) 
       references users
2025-04-23 03:54:43.763 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:54:44.738 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-04-23 03:54:45.711 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider constructor called
2025-04-23 03:54:45.720 [main] DEBUG c.w.u.security.TestJwtTokenProvider - Initializing TestJwtTokenProvider with secure key: ThisIsAVer...
2025-04-23 03:54:45.732 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider initialization completed successfully
2025-04-23 03:54:47.153 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-04-23 03:54:49.638 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator'
2025-04-23 03:54:49.847 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@6b235717, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@6aa658c3, org.springframework.security.web.context.SecurityContextHolderFilter@71dfcc99, org.springframework.security.web.header.HeaderWriterFilter@f979195, org.springframework.web.filter.CorsFilter@18afb626, org.springframework.security.web.authentication.logout.LogoutFilter@1b4f57d6, com.waqiti.user.security.JwtAuthenticationFilter@e4868de, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5f9b4406, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@388e631, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7fa21def, org.springframework.security.web.session.SessionManagementFilter@105674ab, org.springframework.security.web.access.ExceptionTranslationFilter@60f6c836, org.springframework.security.web.access.intercept.AuthorizationFilter@2557ceb0]
2025-04-23 03:54:50.053 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/oauth2/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@69b07727, org.springframework.security.web.session.ForceEagerSessionCreationFilter@33bb8859, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@6a33757, org.springframework.security.web.context.SecurityContextHolderFilter@1ad4e, org.springframework.security.web.header.HeaderWriterFilter@4457ce9, org.springframework.security.web.csrf.CsrfFilter@35d518a7, org.springframework.security.web.authentication.logout.LogoutFilter@32272d0b, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@429c8222, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@7a3eee76, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@2f0c2b93, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@1ae597b2, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@770f0e25, org.springframework.security.web.session.SessionManagementFilter@1b35cd25, org.springframework.security.web.access.ExceptionTranslationFilter@20099dbd, org.springframework.security.web.access.intercept.AuthorizationFilter@4ad7985d]
2025-04-23 03:54:50.249 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@3cea551d, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@72e09a66, org.springframework.security.web.context.SecurityContextHolderFilter@24b190df, org.springframework.security.web.header.HeaderWriterFilter@5a704d15, org.springframework.security.web.authentication.logout.LogoutFilter@4e24b174, org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter@385c3093, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@e0dd692, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5d75b88f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7a2141b4, org.springframework.security.web.session.SessionManagementFilter@44261f25, org.springframework.security.web.access.ExceptionTranslationFilter@2f0d8aa2, org.springframework.security.web.access.intercept.AuthorizationFilter@5e57b7ef]
2025-04-23 03:54:53.318 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring TestDispatcherServlet ''
2025-04-23 03:54:53.318 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-04-23 03:54:53.321 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 2 ms
2025-04-23 03:54:54.225 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 45933 (http) with context path ''
2025-04-23 03:54:54.279 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Started AuthenticationMfaE2ETest in 26.647 seconds (process running for 34.294)
2025-04-23 03:54:54.714 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 03:54:54.744 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 03:54:54.765 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 03:54:54.972 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 03:54:54.984 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 03:54:55.291 [http-nio-auto-1-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-04-23 03:54:55.291 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-04-23 03:54:55.294 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-04-23 03:54:55.310 [http-nio-auto-1-exec-1] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/v1/auth/login' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-04-23 03:54:55.322 [http-nio-auto-1-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 03:54:55.345 [http-nio-auto-1-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 03:54:55.467 [http-nio-auto-1-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 03:54:55.469 [http-nio-auto-1-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 03:54:55.529 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 03:54:55.533 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 03:54:55.535 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 03:54:55.564 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 03:54:55.613 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 03:54:55.619 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 03:54:55.693 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 03:54:55.696 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 03:54:55.704 [http-nio-auto-1-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 03:54:55.705 [http-nio-auto-1-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 03:54:56.566 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 03:54:56.568 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 03:54:56.579 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@3b8ec458 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.580 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@5ce6d34d (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.580 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@6abd166b (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.581 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@733fde1c (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.582 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@2a57458e (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.583 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@76bb2334 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.584 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@16fe2d3a (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.585 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@cd49dc5 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.586 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@4686968e (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 03:54:56.587 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@63ed59 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:06:55.722 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 481372 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 04:06:55.725 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 04:06:55.727 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 04:06:57.886 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 04:06:58.564 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:06:58.564 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 04:06:58.831 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 253 ms. Found 5 JPA repository interfaces.
2025-04-23 04:06:58.900 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:06:58.901 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 04:06:58.980 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 78 ms. Found 5 JPA repository interfaces.
2025-04-23 04:07:00.126 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:07:00.128 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 04:07:00.201 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:07:00.202 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:07:00.203 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:07:00.203 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:07:00.204 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:07:00.204 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 57 ms. Found 0 Redis repository interfaces.
2025-04-23 04:07:00.987 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d8179f7-9ecb-3faf-bd56-72724331021d
2025-04-23 04:07:05.040 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
2025-04-23 04:07:05.056 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-04-23 04:07:05.057 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-04-23 04:07:05.370 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-04-23 04:07:05.371 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 9093 ms
2025-04-23 04:07:06.609 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-04-23 04:07:06.610 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-04-23 04:07:06.611 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-04-23 04:07:06.651 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:32793/testdb (PostgreSQL 13.20)
2025-04-23 04:07:06.703 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table "public"."flyway_schema_history" does not exist yet
2025-04-23 04:07:06.709 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.034s)
2025-04-23 04:07:06.725 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table "public"."flyway_schema_history" ...
2025-04-23 04:07:06.779 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": << Empty Schema >>
2025-04-23 04:07:06.798 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "1 - create user tables"
2025-04-23 04:07:06.844 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "2 - create mfa tables"
2025-04-23 04:07:06.862 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.030s)
2025-04-23 04:07:07.155 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-04-23 04:07:07.311 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-04-23 04:07:07.410 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-04-23 04:07:07.656 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-04-23 04:07:07.723 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-04-23 04:07:07.754 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@70edffdb
2025-04-23 04:07:07.758 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-04-23 04:07:07.831 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-04-23 04:07:09.987 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-04-23 04:07:10.021 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 04:07:10.027 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:07:10.028 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkjcad5nfve11khsnpwj1mv8frj" of relation "user_profiles" does not exist, skipping
2025-04-23 04:07:10.029 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 04:07:10.030 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:07:10.031 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkhfh9dx7w3ubf1co1vdev94g3f" of relation "user_roles" does not exist, skipping
2025-04-23 04:07:10.032 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 04:07:10.034 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 04:07:10.037 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 04:07:10.038 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 04:07:10.040 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 04:07:10.043 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:07:10.043 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - drop cascades to constraint verification_tokens_user_id_fkey on table verification_tokens
2025-04-23 04:07:10.043 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 04:07:10.056 [main] DEBUG org.hibernate.SQL - 
    create table mfa_configurations (
        enabled boolean not null,
        verified boolean not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id uuid not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        secret varchar(255),
        primary key (id)
    )
2025-04-23 04:07:10.060 [main] DEBUG org.hibernate.SQL - 
    create table mfa_verification_codes (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        code varchar(255) not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        primary key (id)
    )
2025-04-23 04:07:10.064 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        date_of_birth date,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        user_id uuid not null,
        address_line1 varchar(255),
        address_line2 varchar(255),
        city varchar(255),
        country varchar(255),
        created_by varchar(255),
        first_name varchar(255),
        last_name varchar(255),
        postal_code varchar(255),
        preferred_currency varchar(255),
        preferred_language varchar(255),
        profile_picture_url varchar(255),
        state varchar(255),
        updated_by varchar(255),
        primary key (user_id)
    )
2025-04-23 04:07:10.066 [main] DEBUG org.hibernate.SQL - 
    create table user_roles (
        user_id uuid not null,
        role varchar(255)
    )
2025-04-23 04:07:10.070 [main] DEBUG org.hibernate.SQL - 
    create table users (
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        created_by varchar(255),
        email varchar(255) not null unique,
        external_id varchar(255) not null,
        kyc_status varchar(255) not null check (kyc_status in ('NOT_STARTED','IN_PROGRESS','PENDING_REVIEW','APPROVED','REJECTED')),
        password_hash varchar(255) not null,
        phone_number varchar(255),
        status varchar(255) not null check (status in ('PENDING','ACTIVE','SUSPENDED','CLOSED')),
        updated_by varchar(255),
        username varchar(255) not null unique,
        primary key (id)
    )
2025-04-23 04:07:10.074 [main] DEBUG org.hibernate.SQL - 
    create table verification_tokens (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        token varchar(255) not null unique,
        type varchar(255) not null check (type in ('EMAIL','PHONE','KYC_BASIC','KYC_FULL','PASSWORD_RESET')),
        primary key (id)
    )
2025-04-23 04:07:10.077 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint FKjcad5nfve11khsnpwj1mv8frj 
       foreign key (user_id) 
       references users
2025-04-23 04:07:10.079 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       add constraint FKhfh9dx7w3ubf1co1vdev94g3f 
       foreign key (user_id) 
       references users
2025-04-23 04:07:10.099 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 04:07:10.990 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-04-23 04:07:12.027 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider constructor called
2025-04-23 04:07:12.035 [main] DEBUG c.w.u.security.TestJwtTokenProvider - Initializing TestJwtTokenProvider with secure key: ThisIsAVer...
2025-04-23 04:07:12.051 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider initialization completed successfully
2025-04-23 04:07:13.493 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-04-23 04:07:15.769 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator'
2025-04-23 04:07:15.940 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@26be3303, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7e62265d, org.springframework.security.web.context.SecurityContextHolderFilter@47f16e92, org.springframework.security.web.header.HeaderWriterFilter@3dcc6e62, org.springframework.web.filter.CorsFilter@1199cc70, org.springframework.security.web.authentication.logout.LogoutFilter@68775a63, com.waqiti.user.security.JwtAuthenticationFilter@7c3aecdc, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6d7eb2bc, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@b5d38bb, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@2b4bfe73, org.springframework.security.web.session.SessionManagementFilter@1a6b7add, org.springframework.security.web.access.ExceptionTranslationFilter@47376146, org.springframework.security.web.access.intercept.AuthorizationFilter@2675ddaf]
2025-04-23 04:07:16.172 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/oauth2/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@27b3077d, org.springframework.security.web.session.ForceEagerSessionCreationFilter@6adb5786, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@4c1c7d22, org.springframework.security.web.context.SecurityContextHolderFilter@151c870d, org.springframework.security.web.header.HeaderWriterFilter@1b35cd25, org.springframework.security.web.csrf.CsrfFilter@65399087, org.springframework.security.web.authentication.logout.LogoutFilter@7e5f596f, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@7ca2516c, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@36c64bd8, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@632093f8, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@642d1c05, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@58313b33, org.springframework.security.web.session.SessionManagementFilter@7ed86bcf, org.springframework.security.web.access.ExceptionTranslationFilter@3e07a967, org.springframework.security.web.access.intercept.AuthorizationFilter@727aec08]
2025-04-23 04:07:16.310 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@356e71a4, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@44be009c, org.springframework.security.web.context.SecurityContextHolderFilter@2417f69f, org.springframework.security.web.header.HeaderWriterFilter@11d85254, org.springframework.security.web.authentication.logout.LogoutFilter@9c10e9c, org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter@6336df27, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@7dcbf7e5, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@2ed250fa, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@695295a9, org.springframework.security.web.session.SessionManagementFilter@47cf6b01, org.springframework.security.web.access.ExceptionTranslationFilter@6f06d068, org.springframework.security.web.access.intercept.AuthorizationFilter@177e6486]
2025-04-23 04:07:19.325 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring TestDispatcherServlet ''
2025-04-23 04:07:19.326 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-04-23 04:07:19.328 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 2 ms
2025-04-23 04:07:20.160 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 39751 (http) with context path ''
2025-04-23 04:07:20.201 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Started AuthenticationMfaE2ETest in 25.287 seconds (process running for 31.851)
2025-04-23 04:07:20.502 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:07:20.522 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:07:20.533 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:07:20.767 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:07:20.781 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:07:21.087 [http-nio-auto-1-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-04-23 04:07:21.088 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-04-23 04:07:21.090 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-04-23 04:07:21.111 [http-nio-auto-1-exec-1] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/v1/auth/login' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-04-23 04:07:21.122 [http-nio-auto-1-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:07:21.144 [http-nio-auto-1-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:07:21.258 [http-nio-auto-1-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:07:21.260 [http-nio-auto-1-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:07:21.333 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:07:21.338 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:07:21.346 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:07:21.384 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 04:07:21.435 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 04:07:21.440 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 04:07:21.512 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:07:21.514 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:07:21.518 [http-nio-auto-1-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:07:21.519 [http-nio-auto-1-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:07:22.362 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 04:07:22.365 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 04:07:22.377 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@70edffdb (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.378 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@69464f34 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.380 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@19291acf (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.381 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@285b00a0 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.383 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@7bf9dd69 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.384 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@6156343 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.389 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@4686968e (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.390 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@63ed59 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.392 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@6480de42 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:07:22.393 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@587df1bb (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:26:37.295 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Starting AuthenticationMfaE2ETest using Java 17.0.14 with PID 484990 (started by aniix in /media/psf/Home/git/waqiti-app/services/user-service)
2025-04-23 04:26:37.298 [main] DEBUG c.w.u.auth.AuthenticationMfaE2ETest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-04-23 04:26:37.299 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - The following 1 profile is active: "test"
2025-04-23 04:26:39.333 [main] WARN  o.s.boot.actuate.endpoint.EndpointId - Endpoint ID 'prometheus.metrics' contains invalid characters, please migrate to a valid format.
2025-04-23 04:26:40.014 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:26:40.014 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 04:26:40.277 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 249 ms. Found 5 JPA repository interfaces.
2025-04-23 04:26:40.342 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:26:40.342 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-04-23 04:26:40.424 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 5 JPA repository interfaces.
2025-04-23 04:26:41.497 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-04-23 04:26:41.499 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-04-23 04:26:41.562 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaConfigurationRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:26:41.566 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.MfaVerificationCodeRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:26:41.571 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserProfileRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:26:41.575 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.UserRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:26:41.576 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.waqiti.user.repository.VerificationTokenRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-04-23 04:26:41.577 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 61 ms. Found 0 Redis repository interfaces.
2025-04-23 04:26:43.715 [main] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=6d8179f7-9ecb-3faf-bd56-72724331021d
2025-04-23 04:26:49.700 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
2025-04-23 04:26:49.720 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-04-23 04:26:49.721 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-04-23 04:26:50.055 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-04-23 04:26:50.055 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 12220 ms
2025-04-23 04:26:51.357 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-04-23 04:26:51.358 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-04-23 04:26:51.358 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-04-23 04:26:51.395 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:32795/testdb (PostgreSQL 13.20)
2025-04-23 04:26:51.464 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table "public"."flyway_schema_history" does not exist yet
2025-04-23 04:26:51.469 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.038s)
2025-04-23 04:26:51.484 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table "public"."flyway_schema_history" ...
2025-04-23 04:26:51.549 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": << Empty Schema >>
2025-04-23 04:26:51.572 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "1 - create user tables"
2025-04-23 04:26:51.618 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "2 - create mfa tables"
2025-04-23 04:26:51.639 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema "public", now at version v2 (execution time 00:00.030s)
2025-04-23 04:26:51.940 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-04-23 04:26:52.096 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-04-23 04:26:52.255 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-04-23 04:26:52.610 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-04-23 04:26:52.681 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-04-23 04:26:52.713 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7537f638
2025-04-23 04:26:52.717 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-04-23 04:26:52.790 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-04-23 04:26:55.225 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-04-23 04:26:55.264 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 04:26:55.269 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:26:55.270 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkjcad5nfve11khsnpwj1mv8frj" of relation "user_profiles" does not exist, skipping
2025-04-23 04:26:55.270 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       drop constraint if exists FKhfh9dx7w3ubf1co1vdev94g3f
2025-04-23 04:26:55.271 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:26:55.272 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "fkhfh9dx7w3ubf1co1vdev94g3f" of relation "user_roles" does not exist, skipping
2025-04-23 04:26:55.272 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_configurations cascade
2025-04-23 04:26:55.275 [main] DEBUG org.hibernate.SQL - 
    drop table if exists mfa_verification_codes cascade
2025-04-23 04:26:55.277 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_profiles cascade
2025-04-23 04:26:55.278 [main] DEBUG org.hibernate.SQL - 
    drop table if exists user_roles cascade
2025-04-23 04:26:55.280 [main] DEBUG org.hibernate.SQL - 
    drop table if exists users cascade
2025-04-23 04:26:55.283 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-04-23 04:26:55.284 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - drop cascades to constraint verification_tokens_user_id_fkey on table verification_tokens
2025-04-23 04:26:55.284 [main] DEBUG org.hibernate.SQL - 
    drop table if exists verification_tokens cascade
2025-04-23 04:26:55.297 [main] DEBUG org.hibernate.SQL - 
    create table mfa_configurations (
        enabled boolean not null,
        verified boolean not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id uuid not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        secret varchar(255),
        primary key (id)
    )
2025-04-23 04:26:55.301 [main] DEBUG org.hibernate.SQL - 
    create table mfa_verification_codes (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        code varchar(255) not null,
        method varchar(255) not null check (method in ('TOTP','SMS','EMAIL','RECOVERY_CODE')),
        primary key (id)
    )
2025-04-23 04:26:55.304 [main] DEBUG org.hibernate.SQL - 
    create table user_profiles (
        date_of_birth date,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        user_id uuid not null,
        address_line1 varchar(255),
        address_line2 varchar(255),
        city varchar(255),
        country varchar(255),
        created_by varchar(255),
        first_name varchar(255),
        last_name varchar(255),
        postal_code varchar(255),
        preferred_currency varchar(255),
        preferred_language varchar(255),
        profile_picture_url varchar(255),
        state varchar(255),
        updated_by varchar(255),
        primary key (user_id)
    )
2025-04-23 04:26:55.307 [main] DEBUG org.hibernate.SQL - 
    create table user_roles (
        user_id uuid not null,
        role varchar(255)
    )
2025-04-23 04:26:55.312 [main] DEBUG org.hibernate.SQL - 
    create table users (
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        created_by varchar(255),
        email varchar(255) not null unique,
        external_id varchar(255) not null,
        kyc_status varchar(255) not null check (kyc_status in ('NOT_STARTED','IN_PROGRESS','PENDING_REVIEW','APPROVED','REJECTED')),
        password_hash varchar(255) not null,
        phone_number varchar(255),
        status varchar(255) not null check (status in ('PENDING','ACTIVE','SUSPENDED','CLOSED')),
        updated_by varchar(255),
        username varchar(255) not null unique,
        primary key (id)
    )
2025-04-23 04:26:55.316 [main] DEBUG org.hibernate.SQL - 
    create table verification_tokens (
        used boolean not null,
        created_at timestamp(6) not null,
        expiry_date timestamp(6) not null,
        id uuid not null,
        user_id uuid not null,
        token varchar(255) not null unique,
        type varchar(255) not null check (type in ('EMAIL','PHONE','KYC_BASIC','KYC_FULL','PASSWORD_RESET')),
        primary key (id)
    )
2025-04-23 04:26:55.319 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       add constraint FKjcad5nfve11khsnpwj1mv8frj 
       foreign key (user_id) 
       references users
2025-04-23 04:26:55.321 [main] DEBUG org.hibernate.SQL - 
    alter table if exists user_roles 
       add constraint FKhfh9dx7w3ubf1co1vdev94g3f 
       foreign key (user_id) 
       references users
2025-04-23 04:26:55.332 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 04:26:56.158 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-04-23 04:26:57.190 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider constructor called
2025-04-23 04:26:57.197 [main] DEBUG c.w.u.security.TestJwtTokenProvider - Initializing TestJwtTokenProvider with secure key: ThisIsAVer...
2025-04-23 04:26:57.211 [main] DEBUG c.w.u.security.TestJwtTokenProvider - TestJwtTokenProvider initialization completed successfully
2025-04-23 04:26:58.720 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-04-23 04:27:01.081 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator'
2025-04-23 04:27:01.261 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@617d6007, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@4ec82627, org.springframework.security.web.context.SecurityContextHolderFilter@5f9a024e, org.springframework.security.web.header.HeaderWriterFilter@27d02a85, org.springframework.web.filter.CorsFilter@2e38e93a, org.springframework.security.web.authentication.logout.LogoutFilter@6e892437, com.waqiti.user.security.JwtAuthenticationFilter@5d92bd50, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@41cc59a9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@16b3794f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@576593bd, org.springframework.security.web.session.SessionManagementFilter@445df038, org.springframework.security.web.access.ExceptionTranslationFilter@601e6724, org.springframework.security.web.access.intercept.AuthorizationFilter@5e9771a5]
2025-04-23 04:27:01.437 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/oauth2/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@26542c47, org.springframework.security.web.session.ForceEagerSessionCreationFilter@54fce9bb, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3a77f91a, org.springframework.security.web.context.SecurityContextHolderFilter@7a5ce089, org.springframework.security.web.header.HeaderWriterFilter@7c91fe1c, org.springframework.security.web.csrf.CsrfFilter@3e220938, org.springframework.security.web.authentication.logout.LogoutFilter@57361968, org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter@12ebc4, org.springframework.security.oauth2.client.web.OAuth2LoginAuthenticationFilter@2a2fda9e, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@94e90c0, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@243e33a5, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@58c41a2e, org.springframework.security.web.session.SessionManagementFilter@ae4e733, org.springframework.security.web.access.ExceptionTranslationFilter@3eb022c2, org.springframework.security.web.access.intercept.AuthorizationFilter@7f75f630]
2025-04-23 04:27:01.550 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure Or [Mvc [pattern='/api/v1/**']] with [org.springframework.security.web.session.DisableEncodeUrlFilter@449d1ad, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@15acb72d, org.springframework.security.web.context.SecurityContextHolderFilter@5707d11f, org.springframework.security.web.header.HeaderWriterFilter@54155e6e, org.springframework.security.web.authentication.logout.LogoutFilter@7e77ec04, org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter@6eae5b0a, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@7ff61b0f, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@1eedcb1, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@36c64bd8, org.springframework.security.web.session.SessionManagementFilter@15407521, org.springframework.security.web.access.ExceptionTranslationFilter@3a524179, org.springframework.security.web.access.intercept.AuthorizationFilter@466ae771]
2025-04-23 04:27:04.561 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring TestDispatcherServlet ''
2025-04-23 04:27:04.561 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-04-23 04:27:04.564 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 1 ms
2025-04-23 04:27:05.532 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 38331 (http) with context path ''
2025-04-23 04:27:05.569 [main] INFO  c.w.u.auth.AuthenticationMfaE2ETest - Started AuthenticationMfaE2ETest in 29.214 seconds (process running for 36.128)
2025-04-23 04:27:05.915 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:27:05.940 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:27:05.948 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:27:06.170 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:27:06.184 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:27:06.447 [http-nio-auto-1-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-04-23 04:27:06.448 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-04-23 04:27:06.450 [http-nio-auto-1-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-04-23 04:27:06.470 [http-nio-auto-1-exec-1] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/actuator/health' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-04-23 04:27:06.482 [http-nio-auto-1-exec-1] DEBUG o.s.security.web.FilterChainProxy - Securing GET /actuator/health
2025-04-23 04:27:06.504 [http-nio-auto-1-exec-1] DEBUG c.w.u.s.JwtAuthenticationFilter - JWT from request: Not present
2025-04-23 04:27:06.508 [http-nio-auto-1-exec-1] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:06.519 [http-nio-auto-1-exec-1] DEBUG o.s.security.web.FilterChainProxy - Secured GET /actuator/health
2025-04-23 04:27:07.067 [boundedElastic-1] WARN  o.s.b.a.d.r.RedisReactiveHealthIndicator - Redis health check failed
org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.translateException(LettuceConnectionFactory.java:1805)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1736)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1538)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.lambda$getConnection$0(LettuceConnectionFactory.java:1518)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.doInLock(LettuceConnectionFactory.java:1478)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1515)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedReactiveConnection(LettuceConnectionFactory.java:1224)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:1099)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:130)
	at reactor.core.publisher.MonoSupplier.call(MonoSupplier.java:67)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:228)
	at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68)
	at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379
	at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:78)
	at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:56)
	at io.lettuce.core.AbstractRedisClient.getConnection(AbstractRedisClient.java:350)
	at io.lettuce.core.RedisClient.connect(RedisClient.java:215)
	at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.lambda$getConnection$1(StandaloneConnectionProvider.java:112)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.getConnection(StandaloneConnectionProvider.java:112)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1734)
	... 16 common frames omitted
Caused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: finishConnect(..) failed: Connection refused: localhost/127.0.0.1:6379
Caused by: java.net.ConnectException: finishConnect(..) failed: Connection refused
	at io.netty.channel.unix.Errors.newConnectException0(Errors.java:166)
	at io.netty.channel.unix.Errors.handleConnectErrno(Errors.java:131)
	at io.netty.channel.unix.Socket.finishConnect(Socket.java:359)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.doFinishConnect(AbstractEpollChannel.java:710)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.finishConnect(AbstractEpollChannel.java:687)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.epollOutReady(AbstractEpollChannel.java:567)
	at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-04-23 04:27:08.275 [http-nio-auto-1-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /actuator/health
2025-04-23 04:27:08.276 [http-nio-auto-1-exec-2] DEBUG c.w.u.s.JwtAuthenticationFilter - JWT from request: Not present
2025-04-23 04:27:08.277 [http-nio-auto-1-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:08.286 [http-nio-auto-1-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /actuator/health
2025-04-23 04:27:08.297 [boundedElastic-1] WARN  o.s.b.a.d.r.RedisReactiveHealthIndicator - Redis health check failed
org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.translateException(LettuceConnectionFactory.java:1805)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1736)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1538)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.lambda$getConnection$0(LettuceConnectionFactory.java:1518)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.doInLock(LettuceConnectionFactory.java:1478)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1515)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getSharedReactiveConnection(LettuceConnectionFactory.java:1224)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:1099)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory.getReactiveConnection(LettuceConnectionFactory.java:130)
	at reactor.core.publisher.MonoSupplier.call(MonoSupplier.java:67)
	at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:228)
	at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68)
	at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: io.lettuce.core.RedisConnectionException: Unable to connect to localhost/<unresolved>:6379
	at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:78)
	at io.lettuce.core.RedisConnectionException.create(RedisConnectionException.java:56)
	at io.lettuce.core.AbstractRedisClient.getConnection(AbstractRedisClient.java:350)
	at io.lettuce.core.RedisClient.connect(RedisClient.java:215)
	at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.lambda$getConnection$1(StandaloneConnectionProvider.java:112)
	at java.base/java.util.Optional.orElseGet(Optional.java:364)
	at org.springframework.data.redis.connection.lettuce.StandaloneConnectionProvider.getConnection(StandaloneConnectionProvider.java:112)
	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$ExceptionTranslatingConnectionProvider.getConnection(LettuceConnectionFactory.java:1734)
	... 16 common frames omitted
Caused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: finishConnect(..) failed: Connection refused: localhost/127.0.0.1:6379
Caused by: java.net.ConnectException: finishConnect(..) failed: Connection refused
	at io.netty.channel.unix.Errors.newConnectException0(Errors.java:166)
	at io.netty.channel.unix.Errors.handleConnectErrno(Errors.java:131)
	at io.netty.channel.unix.Socket.finishConnect(Socket.java:359)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.doFinishConnect(AbstractEpollChannel.java:710)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.finishConnect(AbstractEpollChannel.java:687)
	at io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.epollOutReady(AbstractEpollChannel.java:567)
	at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-04-23 04:27:08.405 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:27:08.408 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:27:08.411 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:27:08.438 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 04:27:08.461 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 04:27:08.467 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 04:27:08.544 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:27:08.546 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:27:08.670 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0 
    where
        u1_0.username=?
2025-04-23 04:27:08.781 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:27:08.783 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:27:08.804 [http-nio-auto-1-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:27:08.805 [http-nio-auto-1-exec-3] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:08.844 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:27:08.849 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:27:08.851 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:27:08.854 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 04:27:08.856 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 04:27:08.859 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 04:27:08.860 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 04:27:08.862 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 04:27:08.863 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 04:27:08.931 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:27:08.932 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:27:08.936 [http-nio-auto-1-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:27:08.938 [http-nio-auto-1-exec-4] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:09.001 [http-nio-auto-1-exec-5] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:27:09.004 [http-nio-auto-1-exec-5] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:09.021 [main] DEBUG org.hibernate.SQL - 
    select
        mc1_0.id,
        mc1_0.created_at,
        mc1_0.enabled,
        mc1_0.method,
        mc1_0.secret,
        mc1_0.updated_at,
        mc1_0.user_id,
        mc1_0.verified,
        mc1_0.version 
    from
        mfa_configurations mc1_0
2025-04-23 04:27:09.025 [main] DEBUG org.hibernate.SQL - 
    select
        mvc1_0.id,
        mvc1_0.code,
        mvc1_0.created_at,
        mvc1_0.expiry_date,
        mvc1_0.method,
        mvc1_0.used,
        mvc1_0.user_id 
    from
        mfa_verification_codes mvc1_0
2025-04-23 04:27:09.030 [main] DEBUG org.hibernate.SQL - 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.created_by,
        u1_0.email,
        u1_0.external_id,
        u1_0.kyc_status,
        u1_0.password_hash,
        u1_0.phone_number,
        u1_0.status,
        u1_0.updated_at,
        u1_0.updated_by,
        u1_0.username,
        u1_0.version 
    from
        users u1_0
2025-04-23 04:27:09.033 [main] DEBUG org.hibernate.SQL - 
    select
        r1_0.user_id,
        r1_0.role 
    from
        user_roles r1_0 
    where
        r1_0.user_id=?
2025-04-23 04:27:09.035 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        user_roles 
    where
        user_id=?
2025-04-23 04:27:09.036 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        users 
    where
        id=? 
        and version=?
2025-04-23 04:27:09.100 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        users
        (created_at, created_by, email, external_id, kyc_status, password_hash, phone_number, status, updated_at, updated_by, username, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-04-23 04:27:09.104 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        user_roles
        (user_id, role) 
    values
        (?, ?)
2025-04-23 04:27:09.108 [http-nio-auto-1-exec-6] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/v1/auth/login
2025-04-23 04:27:09.110 [http-nio-auto-1-exec-6] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-04-23 04:27:10.206 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-23 04:27:10.210 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    alter table if exists user_profiles 
       drop constraint if exists FKjcad5nfve11khsnpwj1mv8frj
2025-04-23 04:27:10.230 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@7537f638 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.237 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@57b33a66 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.240 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@7af4cd15 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.255 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@3d92fa73 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.267 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@59afc2b6 (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.269 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@641ce2fa (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.270 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@3fc972bf (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.272 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@4c0703ba (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.274 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@50d6ceb (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
2025-04-23 04:27:10.276 [SpringApplicationShutdownHook] WARN  com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Failed to validate connection org.postgresql.jdbc.PgConnection@47461b7e (This connection has been closed.). Possibly consider using a shorter maxLifetime value.
